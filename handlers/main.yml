---
# handlers file for openvas
- name: reboot
  shell: (sleep "{{ openvas_reboot_delay }}" && shutdown -r now "ansible-role-update" &)
  async: 1
  poll: 0
  ignore_errors: yes
  when:
    - ansible_virtualization_type != "docker"
  notify:
    - wait for the machine to be up

- name: wait for the machine to be up
  wait_for_connection:
    delay: "{{ openvas_up_delay }}"

- name: setup software
  command: openvas-setup

- name: setup software
  expect:
    command: openvas-setup
    responses:
      "Downloader [Default: rsync]": rsync
      "Allow connections from any IP? [Default: yes]": yes
      "Enter administrator username [Default: admin]": administrator
      "Password:" password
      "Verify Administrator Password:" password
      "Enter Administrator Password:" password
      "Verify Administrator Password:" password
